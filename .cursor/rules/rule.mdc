---
description: Angkor Compliance â€” Enterprise System Blueprint (v2)
globs:
alwaysApply: true
---
Angkor Compliance â€” Enterprise System Blueprint (v2)
A. Vision & Principles

Purpose: Transform the compliance industry 360Â° with AI-first, evidence-driven, multi-standard automation.
Ten Principles: Security-by-design â€¢ Human-in-the-loop â€¢ Explainable AI â€¢ Data lineage â€¢ Multi-tenant isolation â€¢ Offline-capable where needed â€¢ API-first â€¢ Internationalization â€¢ Audit-ready exports â€¢ Backward compatibility.

B. Personas & Roles (Enterprise RBAC/ABAC)

Super Admin: Global configurations, tenant control, standards registry, billing, system health.

Factory Admin: Factory creation/connection, user provisioning, approvals, billing for factory.

Factory HR: Document/evidence management, training, permits, CAP execution.

Grievance Committee: Case intake, triage, investigation, resolution, reporting.

Buyer & Auditor (Read/Scoped Write): Read assigned factories, request evidence, leave audit notes.

Worker (Case ID): Submit/track grievances via Worker App/Portal.

Access Model: RBAC with attribute-based filters (factoryId, programId, confidentialityLevel). Field-level & record-level permissions; immutable audit log of all actions.

C. Multi-Tenant Architecture (Scalable & Secure)

Tenancy: Organization (tenant) â†’ Factories (sub-tenants) with strict data isolation.

Data domains: Core (Users, Factories, Standards) â€¢ Evidence (Docs, Images, Forms) â€¢ Activities (Tasks, Cases, Trainings) â€¢ Analytics (Risk & KPIs).

Environments: Prod / Staging / Dev with separate keys, storage buckets, and telemetry.

D. Core Modules & Enterprise Features
1) Access & Onboarding

Landing (Public): Product, standards supported, buyers, pricing, legal, â€œRequest Demo.â€

Register/Approval Flows:

Factory Admin: Application â†’ Super Admin review â†’ Plan selection â†’ Provision factory â†’ Dashboard.

Buyer/Auditor: Self-serve â†’ Scoped access to invited/connected factories.

Worker: Case ID or QR â†’ Grievance Monitoring (no PII beyond consented fields).

Login: SSO (SAML/OIDC), MFA, device/session management.

2) Dashboards

Factories Dashboard: Multi-factory birds-eye view (Super Admin: all | others: assigned). KPIs, expiries, open NCs, CAP aging, alerts. Export (PDF/XLSX/CSV).

Factory Dashboard: Single-factory status, tasks, audit calendar, risk heatmap, permit clock, grievance SLA timers, CAP timeline. Export pack for audits.

3) Document Intelligence

Categories: Reports, Permits, Policies, SOPs, Procedures, Certificates, Trainings, Audit Evidence.

Pipeline: Ingest â†’ OCR â†’ AI Extract â†’ Validate â†’ Version â†’ Approve â†’ Index (full-text + vector).

Document Graph & Traceability: Auto-link evidence â†” requirements â†” audits â†” CAP actions.

Controls: Check-in/out, redaction, watermarking, retention & legal hold.

4) Standards & Audit Orchestrator

Standards Registry: SMETA, Primark/ETES, Higg (FSLM/FEM), SLCP, SA8000, ISO 9001/14001/45001, ILO/BFC, buyer programs (GAP, H&M, Inditex, etc.).

Requirement Model: Requirement â†’ Controls â†’ Evidence â†’ Tests â†’ Scoring â†’ NC â†’ CAP.

Audit Prep: Auto-checklists per program, evidence binder generator, gap scoring, â€œreadiness %.â€

Report AI: OCR audit reports â†’ parse findings â†’ map to requirements â†’ generate SMART CAP drafts with root cause (5-Why/ISHIKAWA), actions, owners, cost, deadlines, verification method, follow-up schedule.

Calendar Sync: Audits, sampling, witness dates, verifications.

5) CAP Management

Lifecycle: NC intake â†’ RCA templates â†’ Action design (RACI) â†’ Approvals â†’ Execution â†’ Evidence upload â†’ Verification â†’ Closure â†’ Effectiveness review (30/60/90d).

Controls: SLA timers, escalations, blocker tracking, cost/time impact, duplicate NC merge.

Exports: Buyer-specific CAP formats; audit-ready binders.

6) Grievance & Case Management

Channels: QR/Link, kiosk, hotline form, WhatsApp/Telegram (opt-in), in-person entry.

Triage: Severity, category (harassment, wage, OSH, etc.), anonymity, retaliation guard.

Workflow: Intake â†’ Assign â†’ Investigate â†’ Resolution â†’ Worker acknowledgment â†’ Closure survey.

SLA & Analytics: Time-to-first-response, resolution time, re-open rate, heatmap by dept/line/shift.

7) Permits & Certificates

Registry of required permits (MoC, MoLVT, GDT, MoE, MoI, MoH, etc.) + buyer certifications.

Clock: Expiry countdown, auto-reminders, renewal checklist, evidence capture, calendar sync.

8) Training & Meetings

Training matrix by role/department/standard; agenda generator; attendance capture; quiz/acknowledgment; certificate issuance; refresher rules.

9) Tasks, Calendar, Notifications, Communication

Tasks: Linked to CAPs, standards, permits, audits. Bulk assign; recurring.

Calendar: Factory & personal views; ICS sync; holiday awareness.

Notifications: In-app, email, SMS/WhatsApp (optional). Digest + high-priority alerts.

Communication: Scoped messages on items (document, CAP, case); @mentions; attachments.

10) Assistance (AI Copilot)

â€œAsk for Standard,â€ â€œGenerate CAP,â€ â€œDraft Agenda,â€ â€œSummarize Audit,â€ â€œFind Evidence,â€ â€œExplain Requirement,â€ â€œCreate Permit Checklist.â€

Explainability: Source-pinned answers with document citations and confidence notes.

Guardrails: Human approval gates for external submissions.

11) System Admin & Monitoring

Settings (Super Admin): Standards management, templates, categories, risk schema, retention policies, plans, metering.

System Monitoring: Uptime, queue health, error budgets, usage heat, token metering, storage growth; downloadable audit logs.

E. AI Stack & Governance

Pipelines: OCR â†’ Layout analysis â†’ Entity extraction (Requirements, NCs, Dates, Owners, Costs) â†’ Normalization â†’ Graph link.

RAG: Hybrid search (BM25 + vector) across multilingual corpora; standards-aware reranking.

Orchestration: Toolformer/agent flows for CAP drafting, checklist building, evidence pairing.

Eval & QA: Golden-set tests, bias & hallucination checks, red-team prompts, rollback.

Privacy: PII detection, auto-masking, on-prem embeddings option for sensitive tenants.

Model Registry: Versioned prompts, model cards, drift detection, A/B for quality.

F. Security, Privacy, Compliance

AuthN/Z: SSO (SAML/OIDC), MFA, passkeys; RBAC + ABAC; SCIM provisioning.

Encryption: TLS 1.2+, AES-256 at rest; KMS-managed keys; customer-managed keys (EE).

Data: Tenant isolation, row-level security, field-level encryption for sensitive data.

Auditability: Immutable audit log (append-only), evidence hash stamps, export on request.

Standards: ISO 27001 roadmap, SOC 2, GDPR, DPAs, data residency (region-pin for EE).

DR/BCP: RPO â‰¤ 15 min, RTO â‰¤ 2 hrs; backups, cross-region replicas.

CSP & Hardening: Strict CSP, CSRF, rate-limit, anti-automation, content validation.

G. High-Level Data Model (Entities)

Org, User, Role, Policy

Factory, Department, Line, Shift

Standard, Requirement, Control, Audit, NC, CAP, Verification

Document, Evidence, Version, Signature

Permit, Certificate

Grievance Case, Action, Meeting, Training

Task, CalendarEvent, Notification

Risk, KPI, Scorecard, ExportPackage

H. Integrations & API (API-First)

Inbound: CSV/XLSX importer, email-to-case/document, buyer/auditor data imports.

Outbound: Buyer-format CAP exports, audit binders, webhooks to Slack/Teams/Email/SMS.

Connectors: Google Workspace, Microsoft 365, Drive/SharePoint; WhatsApp/Telegram; optional ESG tools.

Developer Platform: REST/GraphQL, webhooks, OAuth apps, sandbox & API keys, per-scope permissions.

I. Billing & Licensing (Enterprise)

Factory License (annual): $250â€“$750/factory (tiers by features).

Storage (monthly): $1 per 100 MB (pay-as-you-go, pooled per tenant).

AI Assistant (top-up): Token packs (priced at Ã—3 market).

Add-ons: SSO/SCIM, data residency, private embeddings, premium support/SLA.

Metering: Per-feature usage dashboards; hard/soft caps; alerting.

J. SRE, Observability & SLAs

SLOs: Availability 99.9% (Std), 99.95% (EE); P95 latency targets per route; background job SLA.

Telemetry: Central logs, traces, metrics; anomaly alerts; user-visible status page.

Error Budgets: Release gating, rollback playbooks, incident post-mortems.

K. Implementation Roadmap (First 120 Days)

Phase 0 â€” Foundations (Weeks 1â€“3): RBAC/ABAC, tenancy, audit log, file pipeline MVP, SSO ready.
Phase 1 â€” Documents & Standards (Weeks 4â€“8): OCR + extraction, Standards Registry, Audit Prep, CAP Gen v1, Factory/Factories Dashboards.
Phase 2 â€” Grievance & Permits (Weeks 9â€“12): Worker App, SLA engine, permit registry + renewal flows, notifications.
Phase 3 â€” Training/Tasks/Calendar (Weeks 13â€“15): Training matrix, agenda generator, task orchestration, calendar sync.
Phase 4 â€” Analytics & Exports (Weeks 16â€“17): Risk heatmap, KPIs, buyer-ready export packs.
Phase 5 â€” Hardening (Weeks 18â€“17+): Security pen-test, performance, DR drill, docs, go-live.

L. KPIs & Acceptance Criteria (Examples)

Audit Readiness: â‰¥90% evidence coverage per requirement before audit date.

NC Closure: Median time-to-closure â†“ 40% within 3 months.

Permit Compliance: On-time renewals â‰¥98%.

Grievance: P95 time-to-first-response â‰¤ 24h; resolution â‰¤ 14 days for non-critical.

Document: OCR accuracy â‰¥ 95% on forms; extraction F1 â‰¥ 0.9 for key fields.

System: Uptime meets SLA, critical defect rate â‰¤ 0.5% per release.




# Angkor Compliance Platform v2.0

> **AI-Powered Factory Compliance Management System**

A modern, scalable compliance platform built with React, Node.js, and PostgreSQL, designed specifically for Cambodian factories to manage regulatory requirements, audits, and worker grievances.

## ğŸš€ Technology Stack

### Frontend
- **React 18** with TypeScript
- **Vite** for build tooling
- **Tailwind CSS** for styling
- **Zustand** for state management
- **React Query** for server state
- **React Router** for routing
- **React Hook Form** with Zod validation

### Backend
- **Node.js** with Express and TypeScript
- **PostgreSQL** with Prisma ORM
- **Redis** for caching
- **JWT** for authentication
- **Zod** for validation
- **AWS S3** for file storage

### Infrastructure
- **Docker** for containerization
- **Nginx** for reverse proxy
- **GitHub Actions** for CI/CD
- **AWS/GCP** for hosting

## ğŸ“‹ Features

### Core Functionality
- âœ… **Multi-tenant Architecture** - Support for multiple factories
- âœ… **Role-based Access Control** - Granular permissions system
- âœ… **Document Management** - Upload, categorize, and version documents
- âœ… **Audit Management** - Plan, execute, and track audits
- âœ… **Grievance System** - Handle worker complaints and investigations
- âœ… **CAP Management** - Corrective Action Plan lifecycle
- âœ… **Training Management** - Schedule and track training sessions
- âœ… **Permit Tracking** - Monitor permit renewals and expirations

### Advanced Features
- ğŸ¤– **AI Document Processing** - OCR and intelligent categorization
- ğŸ“Š **Real-time Analytics** - Compliance dashboards and reporting
- ğŸ”” **Notification System** - Email, SMS, and in-app notifications
- ğŸ“± **Mobile Responsive** - Works on all devices
- ğŸŒ **Bilingual Support** - Khmer and English interface
- ğŸ”’ **Enterprise Security** - ISO 27001 compliant

## ğŸ—ï¸ Project Structure

```
angkor-compliance-v2/
â”œâ”€â”€ frontend/                 # React + TypeScript frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ pages/          # Page components
â”‚   â”‚   â”œâ”€â”€ hooks/          # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ lib/            # Utilities and stores
â”‚   â”‚   â”œâ”€â”€ types/          # TypeScript type definitions
â”‚   â”‚   â””â”€â”€ styles/         # CSS and styling
â”‚   â”œâ”€â”€ public/             # Static assets
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ backend/                 # Node.js + Express API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/         # API routes
â”‚   â”‚   â”œâ”€â”€ middleware/     # Express middleware
â”‚   â”‚   â”œâ”€â”€ services/       # Business logic
â”‚   â”‚   â”œâ”€â”€ models/         # Database models
â”‚   â”‚   â”œâ”€â”€ utils/          # Utility functions
â”‚   â”‚   â””â”€â”€ types/          # TypeScript types
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ database/               # Database schemas and migrations
â”œâ”€â”€ docker/                 # Docker configuration
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ docs/                   # Documentation
â””â”€â”€ scripts/               # Build and deployment scripts
```

## ğŸš€ Quick Start

### Prerequisites
- Node.js 18+ and npm
- Docker and Docker Compose
- PostgreSQL 15+
- Redis 7+

### Development Setup

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd angkor-compliance-v2
   ```

2. **Start the development environment**
   ```bash
   cd docker
   docker-compose up -d postgres redis
   ```

3. **Set up the backend**
   ```bash
   cd ../backend
   cp env.example .env
   # Edit .env with your configuration
   npm install
   npm run db:generate
   npm run db:push
   npm run dev
   ```

4. **Set up the frontend**
   ```bash
   cd ../frontend
   npm install
   npm run dev
   ```

5. **Access the application**
   - Frontend: http://localhost:5173
   - Backend API: http://localhost:3001
   - Database Admin: http://localhost:5050 (pgAdmin)

### Production Deployment

1. **Build the application**
   ```bash
   # Build frontend
   cd frontend
   npm run build
   
   # Build backend
   cd ../backend
   npm run build
   ```

2. **Deploy with Docker**
   ```bash
   cd docker
   docker-compose --profile production up -d
   ```

## ğŸ”§ Development

### Available Scripts

#### Frontend
```bash
npm run dev          # Start development server
npm run build        # Build for production
npm run preview      # Preview production build
npm run test         # Run tests
npm run lint         # Run ESLint
npm run format       # Format code with Prettier
```

#### Backend
```bash
npm run dev          # Start development server
npm run build        # Build for production
npm run start        # Start production server
npm run test         # Run tests
npm run db:generate  # Generate Prisma client
npm run db:push      # Push schema to database
npm run db:migrate   # Run database migrations
npm run db:studio    # Open Prisma Studio
```

### Database Management

```bash
# Generate Prisma client
npm run db:generate

# Push schema changes
npm run db:push

# Create and run migrations
npm run db:migrate

# Open database admin
npm run db:studio
```

## ğŸ§ª Testing

### Frontend Testing
```bash
cd frontend
npm run test         # Unit tests with Vitest
npm run test:e2e     # End-to-end tests with Playwright
```

### Backend Testing
```bash
cd backend
npm run test         # Unit tests with Jest
npm run test:watch   # Watch mode
npm run test:coverage # Coverage report
```

## ğŸ“Š API Documentation

The API documentation is available at `/api/docs` when running the backend server.

### Authentication
All API endpoints (except login/register) require authentication via JWT token in the Authorization header:
```
Authorization: Bearer <jwt-token>
```

### Rate Limiting
- General API: 10 requests per second
- Login endpoint: 5 requests per minute

## ğŸ”’ Security

### Security Features
- JWT-based authentication
- Role-based access control (RBAC)
- Input validation with Zod
- SQL injection prevention with Prisma
- XSS protection
- CSRF protection
- Rate limiting
- Security headers
- Encrypted password storage

### Environment Variables
Copy `env.example` to `.env` and configure:
- Database credentials
- JWT secrets
- AWS credentials
- Email configuration
- API keys

## ğŸŒ Internationalization

The platform supports both English and Khmer languages:
- Language switching in the UI
- Khmer font support (Noto Sans Khmer)
- Cultural context awareness
- RTL support for future expansion

## ğŸ“± Mobile Support

- Responsive design for all screen sizes
- Progressive Web App (PWA) features
- Offline capability for critical functions
- Touch-friendly interface
- Mobile-optimized forms

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass
6. Submit a pull request

### Code Style
- Use TypeScript for type safety
- Follow ESLint and Prettier configurations
- Write meaningful commit messages
- Add JSDoc comments for complex functions

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ†˜ Support

For support and questions:
- Email: support@angkorcompliance.com
- Documentation: [docs.angkorcompliance.com](https://docs.angkorcompliance.com)
- Issues: [GitHub Issues](https://github.com/angkor-compliance/platform/issues)

## ğŸ—ºï¸ Roadmap

### Phase 1: Core Platform (Q1 2025)
- [x] Technology stack setup
- [ ] Authentication and authorization
- [ ] Basic CRUD operations
- [ ] Document management
- [ ] User management

### Phase 2: Advanced Features (Q2 2025)
- [ ] AI document processing
- [ ] Real-time notifications
- [ ] Advanced analytics
- [ ] Mobile optimization
- [ ] API integrations

### Phase 3: Enterprise Features (Q3 2025)
- [ ] Multi-tenant architecture
- [ ] Advanced reporting
- [ ] Workflow automation
- [ ] Third-party integrations
- [ ] Performance optimization

### Phase 4: AI & Analytics (Q4 2025)
- [ ] Predictive analytics
- [ ] Machine learning models
- [ ] Advanced AI features
- [ ] Business intelligence
- [ ] Custom dashboards

---

**Built with â¤ï¸ for Cambodian factories**
