<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Planning - Angkor Compliance 4</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/auditor/audit-planning.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="audit-planning-container">
        <!-- Header Section -->
        <header class="planning-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="page-title">
                        <i data-lucide="calendar"></i>
                        Audit Planning
                    </h1>
                    <p class="page-subtitle">Plan and schedule audit activities systematically</p>
                </div>
                <div class="header-right">
                    <div class="planning-stats">
                        <div class="stat-item">
                            <span class="stat-label">Active Plans</span>
                            <span class="stat-value" id="activePlans">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Upcoming Audits</span>
                            <span class="stat-value" id="upcomingAudits">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Completed</span>
                            <span class="stat-value" id="completedAudits">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="planning-content">
            <!-- Quick Planning Panel -->
            <div class="quick-planning-panel">
                <div class="panel-header">
                    <h2>Quick Audit Planning</h2>
                    <div class="planning-actions">
                        <button class="btn btn-outline" onclick="auditPlanner.openTemplateModal()">
                            <i data-lucide="file-text"></i>
                            Use Template
                        </button>
                        <button class="btn btn-primary" onclick="auditPlanner.openPlanningModal()">
                            <i data-lucide="plus"></i>
                            Create Plan
                        </button>
                    </div>
                </div>

                <!-- Quick Planning Form -->
                <div class="quick-planning-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Audit Type</label>
                            <select id="auditType" class="form-select" onchange="auditPlanner.updateAuditScope()">
                                <option value="">Select Audit Type</option>
                                <option value="internal">Internal Audit</option>
                                <option value="external">External Audit</option>
                                <option value="surveillance">Surveillance Audit</option>
                                <option value="certification">Certification Audit</option>
                                <option value="follow_up">Follow-up Audit</option>
                                <option value="special">Special Investigation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Standard</label>
                            <select id="auditStandard" class="form-select" onchange="auditPlanner.updateScope()">
                                <option value="">Select Standard</option>
                                <option value="iso_9001">ISO 9001 - Quality Management</option>
                                <option value="iso_14001">ISO 14001 - Environmental Management</option>
                                <option value="ohsas_18001">OHSAS 18001 - Occupational Health & Safety</option>
                                <option value="sa_8000">SA 8000 - Social Accountability</option>
                                <option value="custom">Custom Standard</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Scope</label>
                            <select id="auditScope" class="form-select">
                                <option value="">Select Scope</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select id="department" class="form-select">
                                <option value="">Select Department</option>
                                <option value="all">All Departments</option>
                                <option value="production">Production</option>
                                <option value="quality">Quality Control</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="warehouse">Warehouse</option>
                                <option value="office">Office</option>
                                <option value="hr">Human Resources</option>
                                <option value="safety">Safety</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Date</label>
                            <input type="date" id="startDate" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (Days)</label>
                            <input type="number" id="duration" class="form-input" min="1" max="30" value="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planning Overview -->
            <div class="planning-overview">
                <div class="overview-header">
                    <h2>Audit Planning Overview</h2>
                    <div class="overview-filters">
                        <select id="filterStatus" class="filter-select" onchange="auditPlanner.filterPlans()">
                            <option value="all">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <select id="filterType" class="filter-select" onchange="auditPlanner.filterPlans()">
                            <option value="all">All Types</option>
                            <option value="internal">Internal</option>
                            <option value="external">External</option>
                            <option value="surveillance">Surveillance</option>
                            <option value="certification">Certification</option>
                            <option value="follow_up">Follow-up</option>
                            <option value="special">Special</option>
                        </select>
                        <button class="btn btn-outline" onclick="auditPlanner.exportPlans()">
                            <i data-lucide="download"></i>
                            Export
                        </button>
                    </div>
                </div>

                <!-- Planning Grid -->
                <div class="planning-grid" id="planningGrid">
                    <!-- Audit plans will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Planning Modal -->
    <div id="auditPlanningModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Create Audit Plan</h2>
                <button class="modal-close" onclick="auditPlanner.closePlanningModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="auditPlanForm">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Plan Title *</label>
                                <input type="text" id="planTitle" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Audit Type *</label>
                                <select id="modalAuditType" class="form-select" required onchange="auditPlanner.updateModalScope()">
                                    <option value="">Select Audit Type</option>
                                    <option value="internal">Internal Audit</option>
                                    <option value="external">External Audit</option>
                                    <option value="surveillance">Surveillance Audit</option>
                                    <option value="certification">Certification Audit</option>
                                    <option value="follow_up">Follow-up Audit</option>
                                    <option value="special">Special Investigation</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Standard *</label>
                                <select id="modalAuditStandard" class="form-select" required onchange="auditPlanner.updateModalScope()">
                                    <option value="">Select Standard</option>
                                    <option value="iso_9001">ISO 9001 - Quality Management</option>
                                    <option value="iso_14001">ISO 14001 - Environmental Management</option>
                                    <option value="ohsas_18001">OHSAS 18001 - Occupational Health & Safety</option>
                                    <option value="sa_8000">SA 8000 - Social Accountability</option>
                                    <option value="custom">Custom Standard</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Scope *</label>
                                <select id="modalAuditScope" class="form-select" required>
                                    <option value="">Select Scope</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select id="modalDepartment" class="form-select">
                                    <option value="">Select Department</option>
                                    <option value="all">All Departments</option>
                                    <option value="production">Production</option>
                                    <option value="quality">Quality Control</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="warehouse">Warehouse</option>
                                    <option value="office">Office</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="safety">Safety</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority</label>
                                <select id="auditPriority" class="form-select">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Information -->
                    <div class="form-section">
                        <h3>Schedule Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" id="modalStartDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" id="modalEndDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Duration (Days)</label>
                                <input type="number" id="modalDuration" class="form-input" min="1" max="30" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" id="startTime" class="form-input" value="09:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" id="endTime" class="form-input" value="17:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time Zone</label>
                                <select id="timeZone" class="form-select">
                                    <option value="UTC+7">UTC+7 (Cambodia)</option>
                                    <option value="UTC+8">UTC+8 (Singapore)</option>
                                    <option value="UTC+0">UTC+0 (GMT)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Team Assignment -->
                    <div class="form-section">
                        <h3>Team Assignment</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Lead Auditor *</label>
                                <select id="leadAuditor" class="form-select" required>
                                    <option value="">Select Lead Auditor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Team Members</label>
                                <select id="teamMembers" class="form-select" multiple>
                                    <option value="">Select Team Members</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">External Auditors</label>
                                <input type="text" id="externalAuditors" class="form-input" placeholder="Enter external auditor names">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Observer</label>
                                <input type="text" id="observer" class="form-input" placeholder="Enter observer name">
                            </div>
                        </div>
                    </div>

                    <!-- Objectives and Criteria -->
                    <div class="form-section">
                        <h3>Objectives and Criteria</h3>
                        <div class="form-group">
                            <label class="form-label">Audit Objectives *</label>
                            <textarea id="auditObjectives" class="form-textarea" rows="4" 
                                      placeholder="Define the main objectives of this audit..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Audit Criteria</label>
                            <textarea id="auditCriteria" class="form-textarea" rows="4" 
                                      placeholder="Specify the criteria against which the audit will be conducted..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Scope Description</label>
                            <textarea id="scopeDescription" class="form-textarea" rows="3" 
                                      placeholder="Provide a detailed description of the audit scope..."></textarea>
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="form-section">
                        <h3>Risk Assessment</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Risk Level</label>
                                <select id="riskLevel" class="form-select">
                                    <option value="low">Low Risk</option>
                                    <option value="medium" selected>Medium Risk</option>
                                    <option value="high">High Risk</option>
                                    <option value="critical">Critical Risk</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Previous Findings</label>
                                <select id="previousFindings" class="form-select">
                                    <option value="none">No Previous Findings</option>
                                    <option value="minor">Minor Findings</option>
                                    <option value="major">Major Findings</option>
                                    <option value="critical">Critical Findings</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Risk Factors</label>
                            <textarea id="riskFactors" class="form-textarea" rows="3" 
                                      placeholder="Describe any specific risk factors or concerns..."></textarea>
                        </div>
                    </div>

                    <!-- Resources and Logistics -->
                    <div class="form-section">
                        <h3>Resources and Logistics</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Required Resources</label>
                                <textarea id="requiredResources" class="form-textarea" rows="3" 
                                          placeholder="List required resources (equipment, documents, etc.)..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Logistics Notes</label>
                                <textarea id="logisticsNotes" class="form-textarea" rows="3" 
                                          placeholder="Any logistics considerations or special arrangements..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Communication Plan -->
                    <div class="form-section">
                        <h3>Communication Plan</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Opening Meeting</label>
                                <input type="datetime-local" id="openingMeeting" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Closing Meeting</label>
                                <input type="datetime-local" id="closingMeeting" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stakeholders to Notify</label>
                                <textarea id="stakeholders" class="form-textarea" rows="3" 
                                          placeholder="List stakeholders who should be notified about this audit..."></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="auditPlanner.closePlanningModal()">Cancel</button>
                <button class="btn btn-outline" onclick="auditPlanner.saveAsDraft()">Save as Draft</button>
                <button class="btn btn-primary" onclick="auditPlanner.savePlan()">Create Plan</button>
            </div>
        </div>
    </div>

    <!-- Template Selection Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Audit Template</h2>
                <button class="modal-close" onclick="auditPlanner.closeTemplateModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="template-grid" id="templateGrid">
                    <!-- Templates will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="auditPlanner.closeTemplateModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Plan Details Modal -->
    <div id="planDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Audit Plan Details</h2>
                <div class="plan-status">
                    <span class="status-badge" id="planStatusBadge">Draft</span>
                </div>
                <button class="modal-close" onclick="auditPlanner.closeDetailsModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="plan-details-content" id="planDetailsContent">
                    <!-- Plan details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="auditPlanner.closeDetailsModal()">Close</button>
                <button class="btn btn-outline" onclick="auditPlanner.editPlan()">Edit</button>
                <button class="btn btn-outline" onclick="auditPlanner.duplicatePlan()">Duplicate</button>
                <button class="btn btn-primary" onclick="auditPlanner.startAudit()">Start Audit</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i data-lucide="loader-2" class="spinner-icon"></i>
            <p>Processing audit plan...</p>
        </div>
    </div>

    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auditor/audit-planning.js"></script>
</body>
</html>
