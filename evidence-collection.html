<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidence Collection - Angkor Compliance 4</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/auditor/evidence-collection.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div class="evidence-collection-container">
        <!-- Header Section -->
        <header class="evidence-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="page-title">
                        <i data-lucide="folder-open"></i>
                        Evidence Collection
                    </h1>
                    <p class="page-subtitle">Collect and organize audit evidence systematically</p>
                </div>
                <div class="header-right">
                    <div class="evidence-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Evidence</span>
                            <span class="stat-value" id="totalEvidence">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pending Review</span>
                            <span class="stat-value" id="pendingReview">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Storage Used</span>
                            <span class="stat-value" id="storageUsed">0 MB</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="evidence-content">
            <!-- Evidence Collection Panel -->
            <div class="collection-panel">
                <div class="panel-header">
                    <h2>Collect New Evidence</h2>
                    <div class="collection-actions">
                        <button class="btn btn-outline" onclick="evidenceCollector.openBulkUpload()">
                            <i data-lucide="upload"></i>
                            Bulk Upload
                        </button>
                        <button class="btn btn-primary" onclick="evidenceCollector.openCollectionModal()">
                            <i data-lucide="plus"></i>
                            Add Evidence
                        </button>
                    </div>
                </div>

                <!-- Quick Collection Form -->
                <div class="quick-collection-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Audit Standard</label>
                            <select id="auditStandard" class="form-select" onchange="evidenceCollector.updateRequirements()">
                                <option value="">Select Standard</option>
                                <option value="iso_9001">ISO 9001 - Quality Management</option>
                                <option value="iso_14001">ISO 14001 - Environmental Management</option>
                                <option value="ohsas_18001">OHSAS 18001 - Occupational Health & Safety</option>
                                <option value="sa_8000">SA 8000 - Social Accountability</option>
                                <option value="custom">Custom Standard</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Requirement</label>
                            <select id="requirement" class="form-select">
                                <option value="">Select Requirement</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Evidence Type</label>
                            <select id="evidenceType" class="form-select">
                                <option value="">Select Type</option>
                                <option value="document">Document</option>
                                <option value="photo">Photograph</option>
                                <option value="video">Video</option>
                                <option value="audio">Audio Recording</option>
                                <option value="interview">Interview Notes</option>
                                <option value="observation">Observation Notes</option>
                                <option value="sample">Sample/Physical Evidence</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select id="department" class="form-select">
                                <option value="">Select Department</option>
                                <option value="production">Production</option>
                                <option value="quality">Quality Control</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="warehouse">Warehouse</option>
                                <option value="office">Office</option>
                                <option value="hr">Human Resources</option>
                                <option value="safety">Safety</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evidence Organization -->
            <div class="evidence-organization">
                <div class="organization-header">
                    <h2>Evidence Organization</h2>
                    <div class="organization-filters">
                        <select id="filterStandard" class="filter-select" onchange="evidenceCollector.filterEvidence()">
                            <option value="all">All Standards</option>
                        </select>
                        <select id="filterType" class="filter-select" onchange="evidenceCollector.filterEvidence()">
                            <option value="all">All Types</option>
                            <option value="document">Documents</option>
                            <option value="photo">Photos</option>
                            <option value="video">Videos</option>
                            <option value="audio">Audio</option>
                            <option value="interview">Interviews</option>
                            <option value="observation">Observations</option>
                            <option value="sample">Samples</option>
                        </select>
                        <select id="filterStatus" class="filter-select" onchange="evidenceCollector.filterEvidence()">
                            <option value="all">All Status</option>
                            <option value="pending">Pending Review</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="archived">Archived</option>
                        </select>
                        <button class="btn btn-outline" onclick="evidenceCollector.exportEvidence()">
                            <i data-lucide="download"></i>
                            Export
                        </button>
                    </div>
                </div>

                <!-- Evidence Grid -->
                <div class="evidence-grid" id="evidenceGrid">
                    <!-- Evidence items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Evidence Collection Modal -->
    <div id="evidenceCollectionModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Add Evidence</h2>
                <button class="modal-close" onclick="evidenceCollector.closeCollectionModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="evidenceForm">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Evidence Title *</label>
                                <input type="text" id="evidenceTitle" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Audit Standard *</label>
                                <select id="modalAuditStandard" class="form-select" required onchange="evidenceCollector.updateModalRequirements()">
                                    <option value="">Select Standard</option>
                                    <option value="iso_9001">ISO 9001 - Quality Management</option>
                                    <option value="iso_14001">ISO 14001 - Environmental Management</option>
                                    <option value="ohsas_18001">OHSAS 18001 - Occupational Health & Safety</option>
                                    <option value="sa_8000">SA 8000 - Social Accountability</option>
                                    <option value="custom">Custom Standard</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Requirement *</label>
                                <select id="modalRequirement" class="form-select" required>
                                    <option value="">Select Requirement</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Evidence Type *</label>
                                <select id="modalEvidenceType" class="form-select" required onchange="evidenceCollector.toggleEvidenceFields()">
                                    <option value="">Select Type</option>
                                    <option value="document">Document</option>
                                    <option value="photo">Photograph</option>
                                    <option value="video">Video</option>
                                    <option value="audio">Audio Recording</option>
                                    <option value="interview">Interview Notes</option>
                                    <option value="observation">Observation Notes</option>
                                    <option value="sample">Sample/Physical Evidence</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select id="modalDepartment" class="form-select">
                                    <option value="">Select Department</option>
                                    <option value="production">Production</option>
                                    <option value="quality">Quality Control</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="warehouse">Warehouse</option>
                                    <option value="office">Office</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="safety">Safety</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority</label>
                                <select id="evidencePriority" class="form-select">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence Content -->
                    <div class="form-section">
                        <h3>Evidence Content</h3>
                        
                        <!-- File Upload Section -->
                        <div id="fileUploadSection" class="evidence-field">
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-content">
                                    <i data-lucide="upload-cloud"></i>
                                    <h4>Upload Evidence File</h4>
                                    <p>Drag and drop files here or click to browse</p>
                                    <input type="file" id="evidenceFile" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.mp4,.mp3,.wav" style="display: none;">
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('evidenceFile').click()">
                                        Choose Files
                                    </button>
                                </div>
                            </div>
                            <div id="fileList" class="file-list">
                                <!-- Uploaded files will be listed here -->
                            </div>
                        </div>

                        <!-- Text Content Section -->
                        <div id="textContentSection" class="evidence-field" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Evidence Description *</label>
                                <textarea id="evidenceDescription" class="form-textarea" rows="4" 
                                          placeholder="Describe the evidence collected, observations made, or findings documented..."></textarea>
                            </div>
                        </div>

                        <!-- Interview Section -->
                        <div id="interviewSection" class="evidence-field" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Interviewee Name</label>
                                    <input type="text" id="intervieweeName" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Interviewee Role</label>
                                    <input type="text" id="intervieweeRole" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Interview Date</label>
                                    <input type="date" id="interviewDate" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Interview Duration</label>
                                    <input type="text" id="interviewDuration" class="form-input" placeholder="e.g., 30 minutes">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interview Notes *</label>
                                <textarea id="interviewNotes" class="form-textarea" rows="6" 
                                          placeholder="Document the key points discussed during the interview..."></textarea>
                            </div>
                        </div>

                        <!-- Observation Section -->
                        <div id="observationSection" class="evidence-field" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Observation Date</label>
                                    <input type="date" id="observationDate" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Observation Time</label>
                                    <input type="time" id="observationTime" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input type="text" id="observationLocation" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Observer</label>
                                    <input type="text" id="observerName" class="form-input">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Observation Details *</label>
                                <textarea id="observationDetails" class="form-textarea" rows="6" 
                                          placeholder="Document what was observed, including specific details and findings..."></textarea>
                            </div>
                        </div>

                        <!-- Sample Section -->
                        <div id="sampleSection" class="evidence-field" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Sample ID</label>
                                    <input type="text" id="sampleId" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sample Type</label>
                                    <input type="text" id="sampleType" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Collection Date</label>
                                    <input type="date" id="sampleCollectionDate" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Storage Location</label>
                                    <input type="text" id="sampleStorageLocation" class="form-input">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sample Description *</label>
                                <textarea id="sampleDescription" class="form-textarea" rows="4" 
                                          placeholder="Describe the sample collected, its condition, and relevance to the audit..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-section">
                        <h3>Additional Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Tags</label>
                                <input type="text" id="evidenceTags" class="form-input" placeholder="Enter tags separated by commas">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confidentiality Level</label>
                                <select id="confidentialityLevel" class="form-select">
                                    <option value="public">Public</option>
                                    <option value="internal">Internal</option>
                                    <option value="confidential">Confidential</option>
                                    <option value="restricted">Restricted</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea id="evidenceNotes" class="form-textarea" rows="3" 
                                      placeholder="Additional notes or comments about this evidence..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="evidenceCollector.closeCollectionModal()">Cancel</button>
                <button class="btn btn-primary" onclick="evidenceCollector.saveEvidence()">Save Evidence</button>
            </div>
        </div>
    </div>

    <!-- Evidence Review Modal -->
    <div id="evidenceReviewModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Review Evidence</h2>
                <div class="evidence-status">
                    <span class="status-badge" id="reviewEvidenceStatus">Pending</span>
                </div>
                <button class="modal-close" onclick="evidenceCollector.closeReviewModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="evidence-review-content" id="evidenceReviewContent">
                    <!-- Evidence review content will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="evidenceCollector.closeReviewModal()">Close</button>
                <button class="btn btn-outline" onclick="evidenceCollector.rejectEvidence()">Reject</button>
                <button class="btn btn-primary" onclick="evidenceCollector.approveEvidence()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Bulk Upload Evidence</h2>
                <button class="modal-close" onclick="evidenceCollector.closeBulkUploadModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="bulk-upload-content">
                    <div class="upload-area" id="bulkUploadArea">
                        <div class="upload-content">
                            <i data-lucide="upload-cloud"></i>
                            <h4>Upload Multiple Files</h4>
                            <p>Drag and drop multiple files here or click to browse</p>
                            <input type="file" id="bulkEvidenceFiles" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.mp4,.mp3,.wav" style="display: none;">
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('bulkEvidenceFiles').click()">
                                Choose Files
                            </button>
                        </div>
                    </div>
                    <div id="bulkFileList" class="file-list">
                        <!-- Bulk uploaded files will be listed here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="evidenceCollector.closeBulkUploadModal()">Cancel</button>
                <button class="btn btn-primary" onclick="evidenceCollector.processBulkUpload()">Process Upload</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i data-lucide="loader-2" class="spinner-icon"></i>
            <p>Processing evidence...</p>
        </div>
    </div>

    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auditor/evidence-collection.js"></script>
</body>
</html>
