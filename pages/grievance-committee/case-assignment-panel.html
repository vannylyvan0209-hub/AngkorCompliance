<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Assignment Panel - Grievance Committee</title>
    <link rel="icon" type="image/png" href="../../favicon.png">
    <link rel="stylesheet" href="../../assets/css/main-modern.css">
    <link rel="stylesheet" href="../../assets/css/color-system.css">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Role-specific styling for grievance_committee */
        body.role-grievance-committee {
            --role-primary: var(--grievance-primary);
            --role-secondary: var(--grievance-secondary);
            --role-accent: var(--grievance-accent);
        }

        
        .assignment-layout { display: flex; min-height: 100vh; background: var(--neutral-50); }
        .main-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        .page-header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: var(--space-8); }
        .page-title h1 { font-size: var(--text-4xl); font-weight: 800; margin: 0; display: flex; align-items: center; gap: var(--space-3); }
        .assignment-container { padding: var(--space-8); max-width: 1600px; margin: 0 auto; }
        
        /* Assignment Grid */
        .assignment-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-8); }
        
        /* Cases Panel */
        .cases-panel { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); }
        .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .panel-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .panel-actions { display: flex; gap: var(--space-3); }
        
        .cases-list { max-height: 600px; overflow-y: auto; }
        .case-item { background: var(--neutral-50); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-3); cursor: pointer; transition: all 0.2s; }
        .case-item:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .case-item.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .case-item.urgent { border-color: var(--error-500); background: var(--error-50); }
        .case-item.urgent:hover { border-color: var(--error-600); background: var(--error-100); }
        
        .case-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-2); }
        .case-number { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .case-priority { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .priority-low { background: var(--success-100); color: var(--success-700); }
        .priority-medium { background: var(--warning-100); color: var(--warning-700); }
        .priority-high { background: var(--error-100); color: var(--error-700); }
        .priority-critical { background: var(--error-200); color: var(--error-800); }
        
        .case-title { font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-1); font-size: var(--text-sm); }
        .case-category { color: var(--neutral-600); font-size: var(--text-xs); margin-bottom: var(--space-2); }
        .case-meta { display: flex; gap: var(--space-2); flex-wrap: wrap; }
        .case-tag { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .tag-unassigned { background: var(--primary-100); color: var(--primary-700); }
        .tag-urgent { background: var(--error-100); color: var(--error-700); }
        .tag-anonymous { background: var(--warning-100); color: var(--warning-700); }
        
        /* Investigators Panel */
        .investigators-panel { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); }
        
        .investigator-card { background: var(--neutral-50); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4); transition: all 0.2s; }
        .investigator-card:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .investigator-card.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .investigator-card.overloaded { border-color: var(--error-500); background: var(--error-50); }
        
        .investigator-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-3); }
        .investigator-name { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .investigator-status { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .status-available { background: var(--success-100); color: var(--success-700); }
        .status-busy { background: var(--warning-100); color: var(--warning-700); }
        .status-overloaded { background: var(--error-100); color: var(--error-700); }
        
        .investigator-specialties { display: flex; gap: var(--space-1); flex-wrap: wrap; margin-bottom: var(--space-3); }
        .specialty-tag { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; background: var(--primary-100); color: var(--primary-700); }
        
        .workload-info { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-3); }
        .workload-item { text-align: center; }
        .workload-value { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .workload-label { color: var(--neutral-600); font-size: var(--text-xs); }
        
        .workload-bar { width: 100%; height: 6px; background: var(--neutral-200); border-radius: var(--radius-full); overflow: hidden; margin-top: var(--space-1); }
        .workload-fill { height: 100%; border-radius: var(--radius-full); transition: width 0.3s ease; }
        .workload-good { background: var(--success-500); }
        .workload-warning { background: var(--warning-500); }
        .workload-critical { background: var(--error-500); }
        
        /* Assignment Actions */
        .assignment-actions { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); margin-top: var(--space-8); }
        .actions-header { margin-bottom: var(--space-6); }
        .actions-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-2); }
        .actions-subtitle { color: var(--neutral-600); font-size: var(--text-sm); }
        
        .assignment-form { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); }
        
        .form-group { margin-bottom: var(--space-4); }
        .form-label { display: block; font-weight: 600; color: var(--neutral-700); margin-bottom: var(--space-2); }
        .form-select, .form-textarea { width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md); font-size: var(--text-sm); transition: border-color 0.2s; }
        .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-500); box-shadow: 0 0 0 3px var(--primary-100); }
        .form-textarea { min-height: 80px; resize: vertical; }
        
        .assignment-buttons { display: flex; gap: var(--space-4); margin-top: var(--space-6); padding-top: var(--space-6); border-top: 1px solid var(--neutral-200); }
        .btn-secondary { background: var(--neutral-100); color: var(--neutral-700); border: 1px solid var(--neutral-300); }
        .btn-secondary:hover { background: var(--neutral-200); }
        
        /* Auto Assignment */
        .auto-assignment { background: var(--primary-50); border: 1px solid var(--primary-200); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-6); }
        .auto-assignment-header { display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3); }
        .auto-assignment-title { font-weight: 600; color: var(--primary-900); }
        .auto-assignment-description { color: var(--primary-700); font-size: var(--text-sm); margin-bottom: var(--space-3); }
        
        /* Statistics */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-8); }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: var(--space-4); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); text-align: center; }
        .stat-value { font-size: var(--text-2xl); font-weight: 700; color: var(--neutral-900); margin-bottom: var(--space-1); }
        .stat-label { color: var(--neutral-600); font-size: var(--text-sm); }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content { margin-left: 0; }
            .assignment-grid { grid-template-columns: 1fr; }
            .assignment-form { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .page-header { padding: var(--space-6) var(--space-4); }
            .page-title h1 { font-size: var(--text-2xl); }
            .assignment-container { padding: var(--space-4); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .assignment-buttons { flex-direction: column; }
        }
    </style>
</head>
<body class="role-grievance-committee">
    <div class="assignment-layout">
        <div id="sidebarContainer"></div>
        <script>
            fetch('../../assets/html/sidebar-template.html')
                .then(r => r.text())
                .then(html => {
                    document.getElementById('sidebarContainer').innerHTML = html;
                    const el = document.querySelector('.brand-subtitle');
                    if (el) el.textContent = 'Grievance Committee Portal';
                });
        </script>
        
        <main class="main-content">
            <header class="page-header">
                <div class="page-title">
                    <div>
                        <h1><i data-lucide="users"></i> Case Assignment Panel</h1>
                        <p>Assign cases to investigators with workload balancing and skill matching</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline btn-white" onclick="refreshAssignment()" id="refreshBtn">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                        <button class="btn btn-outline btn-white" onclick="autoAssignAll()">
                            <i data-lucide="zap"></i> Auto Assign All
                        </button>
                        <button class="btn btn-primary" onclick="assignSelectedCase()" id="assignBtn" disabled>
                            <i data-lucide="user-check"></i> Assign Case
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="assignment-container">
                <!-- Statistics -->
                <section class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="unassignedCases">0</div>
                        <div class="stat-label">Unassigned Cases</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="availableInvestigators">0</div>
                        <div class="stat-label">Available Investigators</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgWorkload">0</div>
                        <div class="stat-label">Avg Workload</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="urgentCases">0</div>
                        <div class="stat-label">Urgent Cases</div>
                    </div>
                </section>
                
                <div class="assignment-grid">
                    <!-- Cases Panel -->
                    <section class="cases-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Cases Pending Assignment</h2>
                            <div class="panel-actions">
                                <button class="btn btn-outline btn-sm" onclick="filterCases('all')">All</button>
                                <button class="btn btn-outline btn-sm" onclick="filterCases('urgent')">Urgent</button>
                                <button class="btn btn-outline btn-sm" onclick="filterCases('anonymous')">Anonymous</button>
                            </div>
                        </div>
                        
                        <div class="cases-list" id="casesList">
                            <!-- Case items will be populated by JavaScript -->
                        </div>
                    </section>
                    
                    <!-- Investigators Panel -->
                    <section class="investigators-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Available Investigators</h2>
                            <div class="panel-actions">
                                <button class="btn btn-outline btn-sm" onclick="filterInvestigators('all')">All</button>
                                <button class="btn btn-outline btn-sm" onclick="filterInvestigators('available')">Available</button>
                                <button class="btn btn-outline btn-sm" onclick="filterInvestigators('specialists')">Specialists</button>
                            </div>
                        </div>
                        
                        <div id="investigatorsList">
                            <!-- Investigator cards will be populated by JavaScript -->
                        </div>
                    </section>
                </div>
                
                <!-- Assignment Actions -->
                <section class="assignment-actions" id="assignmentActions" style="display: none;">
                    <div class="actions-header">
                        <h2 class="actions-title">Assign Case</h2>
                        <p class="actions-subtitle">Select an investigator and provide assignment details</p>
                    </div>
                    
                    <!-- Auto Assignment Suggestion -->
                    <div class="auto-assignment" id="autoAssignmentSuggestion" style="display: none;">
                        <div class="auto-assignment-header">
                            <i data-lucide="lightbulb"></i>
                            <div class="auto-assignment-title">Recommended Assignment</div>
                        </div>
                        <div class="auto-assignment-description" id="autoAssignmentDescription">
                            Based on workload, skills, and case requirements, we recommend assigning this case to the selected investigator.
                        </div>
                    </div>
                    
                    <div class="assignment-form">
                        <div>
                            <div class="form-group">
                                <label class="form-label">Selected Case</label>
                                <div id="selectedCaseInfo" style="background: var(--neutral-50); padding: var(--space-3); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                                    No case selected
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Selected Investigator</label>
                                <div id="selectedInvestigatorInfo" style="background: var(--neutral-50); padding: var(--space-3); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                                    No investigator selected
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Assignment Priority</label>
                                <select class="form-select" id="assignmentPriority">
                                    <option value="normal">Normal Priority</option>
                                    <option value="high">High Priority</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <div class="form-group">
                                <label class="form-label">Expected Completion Date</label>
                                <input type="date" class="form-select" id="expectedCompletionDate">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Assignment Notes</label>
                                <textarea class="form-textarea" id="assignmentNotes" placeholder="Add any specific instructions or notes for the investigator..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notify Investigator</label>
                                <select class="form-select" id="notificationType">
                                    <option value="immediate">Immediate notification</option>
                                    <option value="email">Email notification</option>
                                    <option value="scheduled">Scheduled notification</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="assignment-buttons">
                        <button class="btn btn-secondary" onclick="clearSelection()">
                            <i data-lucide="x"></i> Clear Selection
                        </button>
                        <button class="btn btn-secondary" onclick="suggestAssignment()">
                            <i data-lucide="lightbulb"></i> Suggest Assignment
                        </button>
                        <button class="btn btn-primary" onclick="confirmAssignment()" id="confirmAssignBtn">
                            <i data-lucide="user-check"></i> Confirm Assignment
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script type="module" src="../../firebase-config.js"></script>
    <script src="../../assets/js/grievance-committee/case-assignment.js"></script>
    <script src="../../assets/js/nav-config.js"></script>
    <script src="../../assets/js/navigation-component.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize navigation system
            const navigation = new NavigationComponent();
            navigation.init();
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
