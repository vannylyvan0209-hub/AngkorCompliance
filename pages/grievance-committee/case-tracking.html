<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Tracking - Grievance Committee</title>
    <link rel="icon" type="image/png" href="../../favicon.png">
    <link rel="stylesheet" href="../../assets/css/main-modern.css">
    <link rel="stylesheet" href="../../assets/css/color-system.css">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Role-specific styling for grievance_committee */
        body.role-grievance-committee {
            --role-primary: var(--grievance-primary);
            --role-secondary: var(--grievance-secondary);
            --role-accent: var(--grievance-accent);
        }

        
        .tracking-layout { display: flex; min-height: 100vh; background: var(--neutral-50); }
        .main-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        .page-header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: var(--space-8); }
        .page-title h1 { font-size: var(--text-4xl); font-weight: 800; margin: 0; display: flex; align-items: center; gap: var(--space-3); }
        .tracking-container { padding: var(--space-8); max-width: 1600px; margin: 0 auto; }
        
        /* Case Selection */
        .case-selection { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); margin-bottom: var(--space-8); }
        .selection-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .selection-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .case-search { display: flex; gap: var(--space-4); align-items: center; }
        .search-input { flex: 1; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md); font-size: var(--text-sm); }
        .search-input:focus { outline: none; border-color: var(--primary-500); box-shadow: 0 0 0 3px var(--primary-100); }
        
        .cases-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--space-4); }
        .case-card { background: var(--neutral-50); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-4); cursor: pointer; transition: all 0.2s; }
        .case-card:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .case-card.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .case-card.urgent { border-color: var(--error-500); background: var(--error-50); }
        .case-card.urgent:hover { border-color: var(--error-600); background: var(--error-100); }
        
        .case-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-3); }
        .case-number { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .case-status { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .status-new { background: var(--primary-100); color: var(--primary-700); }
        .status-assigned { background: var(--warning-100); color: var(--warning-700); }
        .status-investigating { background: var(--info-100); color: var(--info-700); }
        .status-resolved { background: var(--success-100); color: var(--success-700); }
        .status-closed { background: var(--neutral-100); color: var(--neutral-700); }
        
        .case-title { font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-2); font-size: var(--text-sm); }
        .case-meta { display: flex; gap: var(--space-2); flex-wrap: wrap; margin-bottom: var(--space-2); }
        .case-tag { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .tag-priority { background: var(--error-100); color: var(--error-700); }
        .tag-category { background: var(--primary-100); color: var(--primary-700); }
        .tag-assigned { background: var(--warning-100); color: var(--warning-700); }
        
        .case-progress { margin-top: var(--space-3); }
        .progress-bar { width: 100%; height: 6px; background: var(--neutral-200); border-radius: var(--radius-full); overflow: hidden; }
        .progress-fill { height: 100%; border-radius: var(--radius-full); transition: width 0.3s ease; }
        .progress-new { background: var(--primary-500); width: 20%; }
        .progress-assigned { background: var(--warning-500); width: 40%; }
        .progress-investigating { background: var(--info-500); width: 70%; }
        .progress-resolved { background: var(--success-500); width: 90%; }
        .progress-closed { background: var(--neutral-500); width: 100%; }
        
        /* Tracking Dashboard */
        .tracking-dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-8); margin-bottom: var(--space-8); }
        
        /* Case Details */
        .case-details { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); }
        .details-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .details-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .details-actions { display: flex; gap: var(--space-3); }
        
        .case-info { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); margin-bottom: var(--space-6); }
        .info-section { }
        .info-label { font-weight: 600; color: var(--neutral-700); margin-bottom: var(--space-2); font-size: var(--text-sm); }
        .info-value { color: var(--neutral-900); font-size: var(--text-sm); }
        .info-value.urgent { color: var(--error-600); font-weight: 600; }
        
        .case-description { background: var(--neutral-50); padding: var(--space-4); border-radius: var(--radius-md); margin-bottom: var(--space-6); }
        .description-title { font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-2); }
        .description-text { color: var(--neutral-700); line-height: 1.6; }
        
        /* Timeline */
        .timeline { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); }
        .timeline-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .timeline-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .timeline-actions { display: flex; gap: var(--space-3); }
        
        .timeline-container { position: relative; }
        .timeline-line { position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: var(--neutral-300); }
        
        .timeline-item { position: relative; padding-left: 60px; margin-bottom: var(--space-6); }
        .timeline-item:last-child { margin-bottom: 0; }
        .timeline-dot { position: absolute; left: 11px; top: 8px; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 2px var(--neutral-300); }
        .timeline-dot.completed { background: var(--success-500); box-shadow: 0 0 0 2px var(--success-500); }
        .timeline-dot.current { background: var(--primary-500); box-shadow: 0 0 0 2px var(--primary-500); }
        .timeline-dot.pending { background: var(--neutral-300); }
        
        .timeline-content { background: var(--neutral-50); border-radius: var(--radius-lg); padding: var(--space-4); }
        .timeline-header-content { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-2); }
        .timeline-step { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .timeline-date { color: var(--neutral-600); font-size: var(--text-xs); }
        .timeline-description { color: var(--neutral-700); font-size: var(--text-sm); margin-bottom: var(--space-2); }
        .timeline-meta { display: flex; gap: var(--space-2); flex-wrap: wrap; }
        .timeline-tag { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .tag-completed { background: var(--success-100); color: var(--success-700); }
        .tag-current { background: var(--primary-100); color: var(--primary-700); }
        .tag-pending { background: var(--neutral-100); color: var(--neutral-600); }
        
        /* Milestones */
        .milestones { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); margin-bottom: var(--space-8); }
        .milestones-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .milestones-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .milestones-actions { display: flex; gap: var(--space-3); }
        
        .milestones-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-4); }
        .milestone-card { background: var(--neutral-50); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-4); transition: all 0.2s; }
        .milestone-card.completed { border-color: var(--success-500); background: var(--success-50); }
        .milestone-card.current { border-color: var(--primary-500); background: var(--primary-50); }
        .milestone-card.overdue { border-color: var(--error-500); background: var(--error-50); }
        
        .milestone-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-3); }
        .milestone-title { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .milestone-status { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .status-completed { background: var(--success-100); color: var(--success-700); }
        .status-current { background: var(--primary-100); color: var(--primary-700); }
        .status-overdue { background: var(--error-100); color: var(--error-700); }
        .status-pending { background: var(--neutral-100); color: var(--neutral-600); }
        
        .milestone-description { color: var(--neutral-600); font-size: var(--text-xs); margin-bottom: var(--space-3); }
        .milestone-meta { display: flex; justify-content: space-between; align-items: center; }
        .milestone-date { color: var(--neutral-600); font-size: var(--text-xs); }
        .milestone-assignee { color: var(--neutral-600); font-size: var(--text-xs); }
        
        /* Statistics */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-8); }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: var(--space-4); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); text-align: center; }
        .stat-value { font-size: var(--text-2xl); font-weight: 700; color: var(--neutral-900); margin-bottom: var(--space-1); }
        .stat-label { color: var(--neutral-600); font-size: var(--text-sm); }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content { margin-left: 0; }
            .tracking-dashboard { grid-template-columns: 1fr; }
            .case-info { grid-template-columns: 1fr; }
            .cases-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
        }
        
        @media (max-width: 768px) {
            .page-header { padding: var(--space-6) var(--space-4); }
            .page-title h1 { font-size: var(--text-2xl); }
            .tracking-container { padding: var(--space-4); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .cases-grid { grid-template-columns: 1fr; }
            .milestones-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="role-grievance-committee">
    <div class="tracking-layout">
        <div id="sidebarContainer"></div>
        <script>
            fetch('../../assets/html/sidebar-template.html')
                .then(r => r.text())
                .then(html => {
                    document.getElementById('sidebarContainer').innerHTML = html;
                    const el = document.querySelector('.brand-subtitle');
                    if (el) el.textContent = 'Grievance Committee Portal';
                });
        </script>
        
        <main class="main-content">
            <header class="page-header">
                <div class="page-title">
                    <div>
                        <h1><i data-lucide="activity"></i> Case Tracking</h1>
                        <p>Track case progress, milestones, and timeline</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline btn-white" onclick="refreshTracking()" id="refreshBtn">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                        <button class="btn btn-outline btn-white" onclick="exportTracking()">
                            <i data-lucide="download"></i> Export
                        </button>
                        <button class="btn btn-primary" onclick="addMilestone()" id="addMilestoneBtn">
                            <i data-lucide="plus"></i> Add Milestone
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="tracking-container">
                <!-- Statistics -->
                <section class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCases">0</div>
                        <div class="stat-label">Total Cases</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeCases">0</div>
                        <div class="stat-label">Active Cases</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedCases">0</div>
                        <div class="stat-label">Completed Cases</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overdueMilestones">0</div>
                        <div class="stat-label">Overdue Milestones</div>
                    </div>
                </section>
                
                <!-- Case Selection -->
                <section class="case-selection">
                    <div class="selection-header">
                        <h2 class="selection-title">Select Case to Track</h2>
                        <div class="case-search">
                            <input type="text" class="search-input" id="caseSearch" placeholder="Search by case number, title, or assigned person...">
                            <button class="btn btn-outline" onclick="searchCases()">
                                <i data-lucide="search"></i> Search
                            </button>
                        </div>
                    </div>
                    
                    <div class="cases-grid" id="casesGrid">
                        <!-- Case cards will be populated by JavaScript -->
                    </div>
                </section>
                
                <!-- Tracking Dashboard -->
                <div class="tracking-dashboard" id="trackingDashboard" style="display: none;">
                    <!-- Case Details -->
                    <section class="case-details">
                        <div class="details-header">
                            <h2 class="details-title">Case Details</h2>
                            <div class="details-actions">
                                <button class="btn btn-outline btn-sm" onclick="editCase()">
                                    <i data-lucide="edit"></i> Edit
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="viewFullCase()">
                                    <i data-lucide="eye"></i> View Full
                                </button>
                            </div>
                        </div>
                        
                        <div class="case-info">
                            <div class="info-section">
                                <div class="info-label">Case Number</div>
                                <div class="info-value" id="caseNumber">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Status</div>
                                <div class="info-value" id="caseStatus">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Priority</div>
                                <div class="info-value" id="casePriority">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Category</div>
                                <div class="info-value" id="caseCategory">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Assigned To</div>
                                <div class="info-value" id="caseAssignedTo">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Created Date</div>
                                <div class="info-value" id="caseCreatedDate">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Expected Completion</div>
                                <div class="info-value" id="caseExpectedCompletion">-</div>
                            </div>
                            <div class="info-section">
                                <div class="info-label">Days Remaining</div>
                                <div class="info-value" id="caseDaysRemaining">-</div>
                            </div>
                        </div>
                        
                        <div class="case-description">
                            <div class="description-title">Case Description</div>
                            <div class="description-text" id="caseDescription">No case selected</div>
                        </div>
                    </section>
                    
                    <!-- Timeline -->
                    <section class="timeline">
                        <div class="timeline-header">
                            <h2 class="timeline-title">Case Timeline</h2>
                            <div class="timeline-actions">
                                <button class="btn btn-outline btn-sm" onclick="addTimelineEvent()">
                                    <i data-lucide="plus"></i> Add Event
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportTimeline()">
                                    <i data-lucide="download"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="timeline-container">
                            <div class="timeline-line"></div>
                            <div id="timelineEvents">
                                <!-- Timeline events will be populated by JavaScript -->
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Milestones -->
                <section class="milestones" id="milestonesSection" style="display: none;">
                    <div class="milestones-header">
                        <h2 class="milestones-title">Case Milestones</h2>
                        <div class="milestones-actions">
                            <button class="btn btn-outline btn-sm" onclick="filterMilestones('all')">All</button>
                            <button class="btn btn-outline btn-sm" onclick="filterMilestones('completed')">Completed</button>
                            <button class="btn btn-outline btn-sm" onclick="filterMilestones('current')">Current</button>
                            <button class="btn btn-outline btn-sm" onclick="filterMilestones('overdue')">Overdue</button>
                        </div>
                    </div>
                    
                    <div class="milestones-grid" id="milestonesGrid">
                        <!-- Milestone cards will be populated by JavaScript -->
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script type="module" src="../../firebase-config.js"></script>
    <script src="../../assets/js/grievance-committee/case-tracking.js"></script>
    <script src="../../assets/js/nav-config.js"></script>
    <script src="../../assets/js/navigation-component.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize navigation system
            const navigation = new NavigationComponent();
            navigation.init();
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
