<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Triage Modal - Grievance Committee</title>
    <link rel="icon" type="image/png" href="../../favicon.png">
    <link rel="stylesheet" href="../../assets/css/main-modern.css">
    <link rel="stylesheet" href="../../assets/css/color-system.css">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Role-specific styling for grievance_committee */
        body.role-grievance-committee {
            --role-primary: var(--grievance-primary);
            --role-secondary: var(--grievance-secondary);
            --role-accent: var(--grievance-accent);
        }

        
        .triage-layout { display: flex; min-height: 100vh; background: var(--neutral-50); }
        .main-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        .page-header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: var(--space-8); }
        .page-title h1 { font-size: var(--text-4xl); font-weight: 800; margin: 0; display: flex; align-items: center; gap: var(--space-3); }
        .triage-container { padding: var(--space-8); max-width: 1400px; margin: 0 auto; }
        
        /* Case Queue */
        .queue-section { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); margin-bottom: var(--space-8); }
        .queue-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6); }
        .queue-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); }
        .queue-actions { display: flex; gap: var(--space-3); }
        
        .queue-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: var(--space-4); }
        .case-card { background: var(--neutral-50); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); padding: var(--space-4); cursor: pointer; transition: all 0.2s; }
        .case-card:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .case-card.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .case-card.urgent { border-color: var(--error-500); background: var(--error-50); }
        .case-card.urgent:hover { border-color: var(--error-600); background: var(--error-100); }
        
        .case-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-3); }
        .case-number { font-weight: 600; color: var(--neutral-900); font-size: var(--text-sm); }
        .case-time { font-size: var(--text-xs); color: var(--neutral-500); }
        .case-title { font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-2); font-size: var(--text-sm); }
        .case-description { color: var(--neutral-600); font-size: var(--text-xs); margin-bottom: var(--space-3); line-height: 1.4; }
        .case-meta { display: flex; gap: var(--space-2); flex-wrap: wrap; }
        .case-tag { padding: var(--space-1) var(--space-2); border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 500; }
        .tag-new { background: var(--primary-100); color: var(--primary-700); }
        .tag-urgent { background: var(--error-100); color: var(--error-700); }
        .tag-anonymous { background: var(--warning-100); color: var(--warning-700); }
        
        /* Triage Panel */
        .triage-panel { background: white; border-radius: var(--radius-xl); padding: var(--space-6); box-shadow: var(--shadow-sm); border: 1px solid var(--neutral-200); }
        .triage-header { margin-bottom: var(--space-6); }
        .triage-title { font-size: var(--text-xl); font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-2); }
        .triage-subtitle { color: var(--neutral-600); font-size: var(--text-sm); }
        
        .triage-content { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-8); }
        
        /* Case Details */
        .case-details { background: var(--neutral-50); border-radius: var(--radius-lg); padding: var(--space-4); }
        .detail-item { margin-bottom: var(--space-3); }
        .detail-label { font-weight: 600; color: var(--neutral-700); font-size: var(--text-sm); margin-bottom: var(--space-1); }
        .detail-value { color: var(--neutral-900); font-size: var(--text-sm); }
        .detail-value.empty { color: var(--neutral-400); font-style: italic; }
        
        /* Assessment Form */
        .assessment-form { }
        .form-group { margin-bottom: var(--space-6); }
        .form-label { display: block; font-weight: 600; color: var(--neutral-700); margin-bottom: var(--space-2); }
        .form-select, .form-textarea { width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md); font-size: var(--text-sm); transition: border-color 0.2s; }
        .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-500); box-shadow: 0 0 0 3px var(--primary-100); }
        .form-textarea { min-height: 100px; resize: vertical; }
        
        /* Priority Selection */
        .priority-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-3); margin-top: var(--space-3); }
        .priority-option { padding: var(--space-4); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); text-align: center; cursor: pointer; transition: all 0.2s; }
        .priority-option:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .priority-option.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .priority-option.low.selected { border-color: var(--success-500); background: var(--success-100); }
        .priority-option.medium.selected { border-color: var(--warning-500); background: var(--warning-100); }
        .priority-option.high.selected { border-color: var(--error-500); background: var(--error-100); }
        .priority-option.critical.selected { border-color: var(--error-600); background: var(--error-200); }
        .priority-icon { font-size: var(--text-2xl); margin-bottom: var(--space-2); }
        .priority-label { font-weight: 600; font-size: var(--text-sm); }
        .priority-description { font-size: var(--text-xs); color: var(--neutral-600); margin-top: var(--space-1); }
        
        /* Category Selection */
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-3); margin-top: var(--space-3); }
        .category-option { padding: var(--space-4); border: 2px solid var(--neutral-200); border-radius: var(--radius-lg); text-align: center; cursor: pointer; transition: all 0.2s; }
        .category-option:hover { border-color: var(--primary-300); background: var(--primary-50); }
        .category-option.selected { border-color: var(--primary-500); background: var(--primary-100); }
        .category-icon { font-size: var(--text-xl); margin-bottom: var(--space-2); }
        .category-label { font-weight: 600; font-size: var(--text-sm); }
        
        /* Action Buttons */
        .triage-actions { display: flex; gap: var(--space-4); margin-top: var(--space-8); padding-top: var(--space-6); border-top: 1px solid var(--neutral-200); }
        .btn-secondary { background: var(--neutral-100); color: var(--neutral-700); border: 1px solid var(--neutral-300); }
        .btn-secondary:hover { background: var(--neutral-200); }
        
        /* Empty State */
        .empty-state { text-align: center; padding: var(--space-12); color: var(--neutral-500); }
        .empty-icon { font-size: var(--text-4xl); margin-bottom: var(--space-4); }
        .empty-title { font-size: var(--text-lg); font-weight: 600; margin-bottom: var(--space-2); }
        .empty-description { font-size: var(--text-sm); }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content { margin-left: 0; }
            .triage-content { grid-template-columns: 1fr; }
            .queue-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        }
        
        @media (max-width: 768px) {
            .page-header { padding: var(--space-6) var(--space-4); }
            .page-title h1 { font-size: var(--text-2xl); }
            .triage-container { padding: var(--space-4); }
            .queue-grid { grid-template-columns: 1fr; }
            .priority-grid { grid-template-columns: repeat(2, 1fr); }
            .category-grid { grid-template-columns: 1fr; }
            .triage-actions { flex-direction: column; }
        }
    </style>
</head>
<body class="role-grievance-committee">
    <div class="triage-layout">
        <div id="sidebarContainer"></div>
        <script>
            fetch('../../assets/html/sidebar-template.html')
                .then(r => r.text())
                .then(html => {
                    document.getElementById('sidebarContainer').innerHTML = html;
                    const el = document.querySelector('.brand-subtitle');
                    if (el) el.textContent = 'Grievance Committee Portal';
                });
        </script>
        
        <main class="main-content">
            <header class="page-header">
                <div class="page-title">
                    <div>
                        <h1><i data-lucide="clipboard-list"></i> Case Triage</h1>
                        <p>Review and assess new grievance cases for proper categorization and priority assignment</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline btn-white" onclick="refreshQueue()" id="refreshBtn">
                            <i data-lucide="refresh-cw"></i> Refresh Queue
                        </button>
                        <button class="btn btn-outline btn-white" onclick="exportTriageReport()">
                            <i data-lucide="download"></i> Export Report
                        </button>
                        <button class="btn btn-primary" onclick="processSelectedCases()" id="processBtn" disabled>
                            <i data-lucide="check-circle"></i> Process Selected
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="triage-container">
                <!-- Case Queue -->
                <section class="queue-section">
                    <div class="queue-header">
                        <h2 class="queue-title">Cases Pending Triage</h2>
                        <div class="queue-actions">
                            <button class="btn btn-outline btn-sm" onclick="filterByPriority('all')">All</button>
                            <button class="btn btn-outline btn-sm" onclick="filterByPriority('urgent')">Urgent</button>
                            <button class="btn btn-outline btn-sm" onclick="filterByPriority('new')">New</button>
                            <button class="btn btn-outline btn-sm" onclick="filterByPriority('anonymous')">Anonymous</button>
                        </div>
                    </div>
                    
                    <div class="queue-grid" id="caseQueue">
                        <!-- Case cards will be populated by JavaScript -->
                    </div>
                </section>
                
                <!-- Triage Panel -->
                <section class="triage-panel" id="triagePanel" style="display: none;">
                    <div class="triage-header">
                        <h2 class="triage-title">Case Assessment</h2>
                        <p class="triage-subtitle">Review case details and assign appropriate category and priority</p>
                    </div>
                    
                    <div class="triage-content">
                        <!-- Case Details -->
                        <div class="case-details">
                            <h3 style="margin-bottom: var(--space-4); color: var(--neutral-900);">Case Information</h3>
                            
                            <div class="detail-item">
                                <div class="detail-label">Case Number</div>
                                <div class="detail-value" id="triageCaseNumber">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Case Title</div>
                                <div class="detail-value" id="triageCaseTitle">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Description</div>
                                <div class="detail-value" id="triageDescription">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Worker Information</div>
                                <div class="detail-value" id="triageWorkerInfo">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Incident Date</div>
                                <div class="detail-value" id="triageIncidentDate">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Location</div>
                                <div class="detail-value" id="triageLocation">-</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Submitted</div>
                                <div class="detail-value" id="triageSubmitted">-</div>
                            </div>
                        </div>
                        
                        <!-- Assessment Form -->
                        <div class="assessment-form">
                            <h3 style="margin-bottom: var(--space-4); color: var(--neutral-900);">Assessment & Assignment</h3>
                            
                            <!-- Category Assignment -->
                            <div class="form-group">
                                <label class="form-label">Grievance Category</label>
                                <div class="category-grid">
                                    <div class="category-option" data-category="harassment" onclick="selectTriageCategory('harassment')">
                                        <div class="category-icon">🚫</div>
                                        <div class="category-label">Harassment</div>
                                    </div>
                                    <div class="category-option" data-category="wage" onclick="selectTriageCategory('wage')">
                                        <div class="category-icon">💰</div>
                                        <div class="category-label">Wage Issues</div>
                                    </div>
                                    <div class="category-option" data-category="safety" onclick="selectTriageCategory('safety')">
                                        <div class="category-icon">⚠️</div>
                                        <div class="category-label">Safety Concerns</div>
                                    </div>
                                    <div class="category-option" data-category="discrimination" onclick="selectTriageCategory('discrimination')">
                                        <div class="category-icon">⚖️</div>
                                        <div class="category-label">Discrimination</div>
                                    </div>
                                    <div class="category-option" data-category="working_conditions" onclick="selectTriageCategory('working_conditions')">
                                        <div class="category-icon">🏭</div>
                                        <div class="category-label">Working Conditions</div>
                                    </div>
                                    <div class="category-option" data-category="other" onclick="selectTriageCategory('other')">
                                        <div class="category-icon">📋</div>
                                        <div class="category-label">Other</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Priority Assignment -->
                            <div class="form-group">
                                <label class="form-label">Priority Level</label>
                                <div class="priority-grid">
                                    <div class="priority-option low" data-priority="low" onclick="selectTriagePriority('low')">
                                        <div class="priority-icon">🟢</div>
                                        <div class="priority-label">Low</div>
                                        <div class="priority-description">Standard processing</div>
                                    </div>
                                    <div class="priority-option medium" data-priority="medium" onclick="selectTriagePriority('medium')">
                                        <div class="priority-icon">🟡</div>
                                        <div class="priority-label">Medium</div>
                                        <div class="priority-description">Elevated attention</div>
                                    </div>
                                    <div class="priority-option high" data-priority="high" onclick="selectTriagePriority('high')">
                                        <div class="priority-icon">🟠</div>
                                        <div class="priority-label">High</div>
                                        <div class="priority-description">Urgent action needed</div>
                                    </div>
                                    <div class="priority-option critical" data-priority="critical" onclick="selectTriagePriority('critical')">
                                        <div class="priority-icon">🔴</div>
                                        <div class="priority-label">Critical</div>
                                        <div class="priority-description">Immediate response</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Severity Assessment -->
                            <div class="form-group">
                                <label class="form-label">Severity Assessment</label>
                                <select class="form-select" id="triageSeverity">
                                    <option value="">Select severity level</option>
                                    <option value="low">Low - Minor issue, no immediate risk</option>
                                    <option value="medium">Medium - Moderate concern, needs attention</option>
                                    <option value="high">High - Serious issue, urgent action needed</option>
                                    <option value="critical">Critical - Emergency situation, immediate response</option>
                                </select>
                            </div>
                            
                            <!-- Recommended Investigator -->
                            <div class="form-group">
                                <label class="form-label">Recommended Investigator</label>
                                <select class="form-select" id="triageInvestigator">
                                    <option value="">Select investigator</option>
                                    <option value="john_doe">John Doe - Harassment Specialist</option>
                                    <option value="jane_smith">Jane Smith - Wage & Benefits Expert</option>
                                    <option value="mike_johnson">Mike Johnson - Safety & Compliance</option>
                                    <option value="sarah_wilson">Sarah Wilson - Discrimination & HR</option>
                                    <option value="auto_assign">Auto-assign based on workload</option>
                                </select>
                            </div>
                            
                            <!-- Triage Notes -->
                            <div class="form-group">
                                <label class="form-label">Triage Notes</label>
                                <textarea class="form-textarea" id="triageNotes" placeholder="Add any additional notes, observations, or recommendations for the investigation..."></textarea>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="triage-actions">
                                <button class="btn btn-secondary" onclick="skipCase()">
                                    <i data-lucide="skip-forward"></i> Skip Case
                                </button>
                                <button class="btn btn-secondary" onclick="escalateCase()">
                                    <i data-lucide="alert-triangle"></i> Escalate
                                </button>
                                <button class="btn btn-primary" onclick="completeTriage()" id="completeTriageBtn">
                                    <i data-lucide="check-circle"></i> Complete Triage
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">📋</div>
                    <div class="empty-title">No Cases Pending Triage</div>
                    <div class="empty-description">All cases have been processed or there are no new cases in the queue.</div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script type="module" src="../../firebase-config.js"></script>
    <script src="../../assets/js/grievance-committee/case-triage.js"></script>
    <script src="../../assets/js/nav-config.js"></script>
    <script src="../../assets/js/navigation-component.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize navigation system
            const navigation = new NavigationComponent();
            navigation.init();
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
